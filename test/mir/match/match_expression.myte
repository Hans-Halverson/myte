module test

fun testMatchExpressionBlockValues(test: Bool) {
  val x: Int = match (test) {
    | true -> {
      1
    }
    | false -> {
      2
    }
  };
  use(x);
}

fun testMatchStatementInExpressionPosition(test: Bool) {
  val x: Int = if (test) {
    match (test) {
      | true -> {
        1
      }
      | false -> 2
    }
  } else {
    3
  };
  use(x);
}

fun testNestedMatchAndIf(test: Bool) {
  val x: Int = if (test) {
    match (test) {
      | true -> {
        if (test) {
          match (test) {
            | true -> 1
            | false -> 2
          }
        } else {
          match (test) {
            | true -> 3
            | false -> 4
          }
        }
      }
      | false -> 5
    }
  } else {
    6
  };
  use(x);
}

type ZeroSize (Unit)

fun testZeroSizeMatch(test: Bool) {
  val x: ZeroSize = match (test) {
    | true -> {
      use(true);
      ZeroSize (())
    }
    | false -> {
      use(false);
      ZeroSize (())
    }
  };
  use(x);
}

fun testUnitMatch(test: Int) {
  val x: Unit = match (test) {
    | 1 -> ()
    | 2 -> { () }
    | 3 -> use(3)
    | _ -> {}
  };
  use(x);
}

fun use<T>(x: T) {}

fun main() {
  use(testMatchExpressionBlockValues);
  use(testMatchStatementInExpressionPosition);
  use(testNestedMatchAndIf);
  use(testZeroSizeMatch);
  use(testUnitMatch);
}